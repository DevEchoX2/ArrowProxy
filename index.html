<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pluto — Unblocked Games</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#2b2b31">
  <link rel="manifest" href="data:application/json,{&quot;name&quot;:&quot;Pluto&quot;,&quot;short_name&quot;:&quot;Pluto&quot;,&quot;start_url&quot;:&quot;.&quot;,&quot;display&quot;:&quot;standalone&quot;,&quot;background_color&quot;:&quot;#1b1b20&quot;,&quot;theme_color&quot;:&quot;#2b2b31&quot;}">
  <style>
    /* Pluto-inspired palette: cold charcoal, dusty taupe, pale ice */
    :root {
      --bg: #1b1b20;          /* deep space */
      --bg-2: #232329;        /* layered depth */
      --card: #2b2b31;        /* panels */
      --text: #e8e6e3;        /* soft light */
      --muted: #bdb8b0;       /* pluto regolith tones */
      --accent: #c9a27d;      /* warm taupe highlight */
      --accent-2: #8c7460;    /* darker accent */
      --ice: #dfe5e7;         /* nitrogen ice hint */
      --error: #ff6b6b;
      --ok: #82d173;
      --focus: #a78b7c;       /* focus ring */
      --shadow: 0 10px 30px rgba(0,0,0,0.35);
      --radius: 14px;
    }

    * { box-sizing: border-box }
    html, body { height: 100% }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
      color: var(--text);
      background:
        radial-gradient(1200px 800px at 50% -200px, #2b2b31 0%, #1b1b20 50%, #111117 100%),
        linear-gradient(180deg, #1b1b20, #111117);
    }

    /* Layout */
    header {
      position: sticky; top: 0; z-index: 50;
      backdrop-filter: blur(8px);
      background: rgba(27,27,32,0.7);
      border-bottom: 1px solid #2c2c33;
    }
    .bar {
      display: grid; grid-template-columns: 180px 1fr auto;
      gap: 12px; align-items: center;
      padding: 12px 20px;
    }
    .logo {
      display: flex; align-items: center; gap: 10px;
      font-weight: 700; letter-spacing: 0.4px;
    }
    .logo .dot {
      width: 28px; height: 28px; border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, var(--accent) 0%, var(--accent-2) 55%, #2b2b31 100%);
      box-shadow: 0 0 0 2px #3a2f28, inset 0 0 20px rgba(0,0,0,0.5);
    }
    .logo span { font-size: 18px }

    .search {
      display: flex; align-items: center; gap: 10px;
      background: var(--card); border: 1px solid #3a3a44;
      border-radius: 999px; padding: 10px 14px; box-shadow: var(--shadow);
    }
    .search input {
      flex: 1; background: transparent; border: none; color: var(--text);
      font-size: 15px; outline: none;
    }
    .search kbd {
      background: #2f2f38; color: var(--muted);
      border-radius: 6px; padding: 4px 6px; font-size: 12px;
    }

    .actions { display: flex; gap: 8px }
    .btn {
      background: var(--card); border: 1px solid #3a3a44; color: var(--text);
      border-radius: 12px; padding: 10px 12px; cursor: pointer;
      transition: transform .08s ease, background .2s ease, border .2s ease;
    }
    .btn:hover { transform: translateY(-1px); background: #33333b }
    .btn.active { border-color: var(--accent); color: var(--accent) }

    /* Pluto image centerpiece */
    .hero {
      max-width: 1100px; margin: 22px auto; padding: 0 20px;
      display: grid; grid-template-columns: 1fr 340px; gap: 24px;
      align-items: center;
    }
    .hero-card {
      background: var(--card); border: 1px solid #3a3a44; border-radius: var(--radius);
      padding: 16px; box-shadow: var(--shadow);
    }
    .hero-card h2 { margin: 0 0 8px 0; font-size: 22px }
    .hero-card p { margin: 0; color: var(--muted) }

    .pluto-img-wrap {
      display: grid; place-items: center;
      background:
        radial-gradient(220px 220px at 50% 50%, rgba(255,255,255,0.06) 0%, rgba(255,255,255,0) 60%),
        linear-gradient(180deg, rgba(255,255,255,0.04), rgba(0,0,0,0.08));
      border: 1px solid #3a3a44; border-radius: var(--radius);
      box-shadow: var(--shadow);
      position: relative; overflow: hidden;
    }
    .pluto-img {
      width: 90%; max-width: 300px; aspect-ratio: 1/1; border-radius: 50%;
      object-fit: cover; border: 2px solid #3a2f28;
      box-shadow: 0 30px 60px rgba(0,0,0,0.55), inset 0 0 40px rgba(0,0,0,0.4);
    }
    .pluto-caption {
      position: absolute; bottom: 10px; left: 12px;
      font-size: 12px; color: var(--muted);
      background: rgba(0,0,0,0.35); padding: 6px 8px; border-radius: 8px;
    }

    /* Filters and chips */
    .filters {
      max-width: 1100px; margin: 8px auto 0; padding: 0 20px;
      display: flex; flex-wrap: wrap; gap: 8px;
    }
    .chip {
      background: #2f2f38; color: var(--text);
      border: 1px solid #3a3a44; border-radius: 999px;
      padding: 8px 12px; cursor: pointer;
    }
    .chip.active {
      border-color: var(--accent); color: var(--accent); background: #35353d;
    }

    /* Grid */
    .grid {
      max-width: 1100px; margin: 16px auto 80px; padding: 0 20px;
      display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 14px;
    }
    .card {
      background: var(--card); border: 1px solid #3a3a44; border-radius: var(--radius);
      overflow: hidden; box-shadow: var(--shadow); position: relative;
    }
    .thumb {
      aspect-ratio: 16/9; background: #26262e; display: grid; place-items: center;
      color: var(--muted); font-weight: 600; letter-spacing: 0.3px;
    }
    .meta { padding: 12px; display: grid; gap: 8px }
    .tags { display: flex; gap: 6px; flex-wrap: wrap }
    .tag {
      font-size: 12px; color: var(--muted); background: #2f2f38;
      border: 1px solid #3a3a44; border-radius: 999px; padding: 3px 8px;
    }
    .row { display: flex; justify-content: space-between; align-items: center }
    .play {
      background: #35353d; color: var(--text); border: 1px solid #474752;
      padding: 8px 10px; border-radius: 10px; cursor: pointer;
    }
    .pin { background: transparent; border: none; color: var(--muted); cursor: pointer }

    /* Player */
    .player {
      position: fixed; inset: auto 20px 20px 20px; z-index: 60;
      display: none; grid-template-rows: auto 1fr;
      background: var(--bg-2); border: 1px solid #3a3a44; border-radius: 16px; box-shadow: var(--shadow);
      max-height: 80vh;
    }
    .player.visible { display: grid }
    .player-bar { display: flex; align-items: center; gap: 8px; padding: 10px 12px; border-bottom: 1px solid #3a3a44 }
    .player-title { flex: 1 }
    .player-iframe {
      width: 100%; height: 60vh; border: none; background: #15151a;
    }
    .kbd-tip { font-size: 12px; color: var(--muted) }

    /* A11y */
    .visually-hidden {
      position: absolute !important;
      height: 1px; width: 1px; overflow: hidden;
      clip: rect(1px, 1px, 1px, 1px); white-space: nowrap;
    }

    /* Focus rings */
    .btn:focus, .chip:focus, .play:focus, .pin:focus, .search input:focus {
      outline: 2px solid var(--focus); outline-offset: 2px;
    }
  </style>
</head>
<body>
  <a href="#content" class="visually-hidden">Skip to content</a>

  <header role="banner" aria-label="Top bar">
    <div class="bar">
      <div class="logo" aria-label="Pluto logo">
        <div class="dot" aria-hidden="true"></div>
        <span>Pluto</span>
      </div>

      <div class="search" role="search">
        <input id="search" type="text" placeholder="Search games, tags, genres…" aria-label="Search games" />
        <kbd>/</kbd>
      </div>

      <div class="actions">
        <button class="btn" id="favoritesBtn" aria-pressed="false" title="Show favorites">Favorites</button>
        <button class="btn" id="historyBtn" aria-pressed="false" title="Show history">History</button>
        <button class="btn" id="safeBtn" aria-pressed="false" title="Safe mode">Safe mode</button>
      </div>
    </div>
  </header>

  <main id="content" role="main" aria-label="Content">
    <section class="hero" aria-label="Spotlight">
      <div class="hero-card">
        <h2>Spotlight</h2>
        <p>Discover trending mirrors, fresh drops, and editor picks. Use / to search and F for favorites.</p>
      </div>

      <div class="pluto-img-wrap">
        <!-- Public-domain Pluto image (New Horizons) -->
        <img class="pluto-img" alt="Pluto — New Horizons global mosaic" src="https://upload.wikimedia.org/wikipedia/commons/2/2a/Pluto_by_LORRI_and_Ralph%2C_13_July_2015.jpg">
        <div class="pluto-caption">Pluto, New Horizons (Public domain)</div>
      </div>
    </section>

    <section class="filters" aria-label="Filters">
      <button class="chip active" data-genre="all">All</button>
      <button class="chip" data-genre="Action">Action</button>
      <button class="chip" data-genre="Puzzle">Puzzle</button>
      <button class="chip" data-genre="Strategy">Strategy</button>
      <button class="chip" data-genre="Retro">Retro</button>
      <button class="chip" data-genre="Casual">Casual</button>
    </section>

    <section class="grid" id="grid" aria-label="Game grid">
      <!-- Cards render here -->
    </section>
  </main>

  <section class="player" id="player" aria-label="In-app player" role="dialog" aria-modal="true">
    <div class="player-bar">
      <div class="player-title" id="playerTitle">No game loaded</div>
      <span class="kbd-tip">Popout: P • Next: N • Close: Esc</span>
      <button class="btn" id="popBtn">Popout</button>
      <button class="btn" id="closeBtn">Close</button>
    </div>
    <iframe id="frame" class="player-iframe" sandbox="allow-scripts allow-forms allow-pointer-lock allow-popups allow-same-origin" referrerpolicy="no-referrer"></iframe>
  </section>

  <footer style="max-width:1100px;margin:20px auto 40px;padding:0 20px;color:var(--muted)">
    Pluto is a community-curated launcher. Mirrors may change; use Safe mode for sandbox sources.
  </footer>

  <script>
    /* Data: demo catalog with mirrors and tags */
    const catalog = [
      {
        id: 'slope', title: 'Slope',
        genre: 'Action', tags: ['fast', 'runner', 'skill'],
        mirrors: [
          { url: 'https://example-mirror1.com/slope', safe: false, score: 0.97 },
          { url: 'https://example-sandbox.com/slope', safe: true, score: 0.91 }
        ]
      },
      {
        id: '2048', title: '2048',
        genre: 'Puzzle', tags: ['numbers', 'casual', 'offline'],
        mirrors: [
          { url: 'https://example-mirror2.com/2048', safe: false, score: 0.88 },
          { url: 'https://example-sandbox.com/2048', safe: true, score: 0.93 }
        ]
      },
      {
        id: 'chess', title: 'Chess Minimal',
        genre: 'Strategy', tags: ['board', 'pvp', 'classic'],
        mirrors: [
          { url: 'https://example-mirror3.com/chess', safe: false, score: 0.8 },
          { url: 'https://example-sandbox.com/chess', safe: true, score: 0.86 }
        ]
      },
      {
        id: 'tetris', title: 'Tetris Retro',
        genre: 'Retro', tags: ['blocks', 'classic', 'music'],
        mirrors: [
          { url: 'https://example-mirror4.com/tetris', safe: false, score: 0.75 },
          { url: 'https://example-sandbox.com/tetris', safe: true, score: 0.89 }
        ]
      },
      {
        id: 'clicker', title: 'Astro Clicker',
        genre: 'Casual', tags: ['idle', 'incremental', 'space'],
        mirrors: [
          { url: 'https://example-mirror5.com/clicker', safe: false, score: 0.7 },
          { url: 'https://example-sandbox.com/clicker', safe: true, score: 0.9 }
        ]
      }
    ];

    /* State */
    const state = {
      search: '',
      genre: 'all',
      favorites: JSON.parse(localStorage.getItem('pluto:favorites') || '[]'),
      history: JSON.parse(localStorage.getItem('pluto:history') || '[]'),
      safeMode: false,
      playing: null
    };

    /* Elements */
    const gridEl = document.getElementById('grid');
    const searchEl = document.getElementById('search');
    const favoritesBtn = document.getElementById('favoritesBtn');
    const historyBtn = document.getElementById('historyBtn');
    const safeBtn = document.getElementById('safeBtn');
    const playerEl = document.getElementById('player');
    const frameEl = document.getElementById('frame');
    const playerTitleEl = document.getElementById('playerTitle');
    const popBtn = document.getElementById('popBtn');
    const closeBtn = document.getElementById('closeBtn');

    /* Keyboard shortcuts */
    window.addEventListener('keydown', (e) => {
      if (e.key === '/') { e.preventDefault(); searchEl.focus(); }
      if (e.key.toLowerCase() === 'f') { toggleFavoritesView(); }
      if (e.key.toLowerCase() === 'l') { showLastPlayed(); }
      if (e.key.toLowerCase() === 'p') { popout(); }
      if (e.key.toLowerCase() === 'n') { loadNextInQueue(); }
      if (e.key === 'Escape') { closePlayer(); }
    });

    /* Search */
    searchEl.addEventListener('input', (e) => {
      state.search = e.target.value.trim().toLowerCase();
      render();
    });

    /* Genre chips */
    document.querySelectorAll('.chip').forEach(chip => {
      chip.addEventListener('click', () => {
        document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
        chip.classList.add('active');
        state.genre = chip.dataset.genre;
        render();
      });
    });

    /* Safe mode */
    safeBtn.addEventListener('click', () => {
      state.safeMode = !state.safeMode;
      safeBtn.classList.toggle('active', state.safeMode);
      safeBtn.setAttribute('aria-pressed', String(state.safeMode));
      render();
    });

    /* Favorites/history toggles */
    favoritesBtn.addEventListener('click', toggleFavoritesView);
    historyBtn.addEventListener('click', () => {
      historyBtn.classList.toggle('active');
      favoritesBtn.classList.remove('active');
      render();
    });

    function toggleFavoritesView() {
      const active = favoritesBtn.classList.toggle('active');
      if (active) historyBtn.classList.remove('active');
      render();
    }

    /* Renderer */
    function render() {
      const isFavorites = favoritesBtn.classList.contains('active');
      const isHistory = historyBtn.classList.contains('active');

      let items = [...catalog];

      // Filter by genre
      if (state.genre !== 'all') {
        items = items.filter(i => i.genre === state.genre);
      }

      // Safe mode mirror pruning
      const filteredMirrors = (mirrors) => {
        const m = state.safeMode ? mirrors.filter(x => x.safe) : mirrors;
        // Sort by score desc
        return m.sort((a,b) => b.score - a.score);
      };

      // Search
      if (state.search) {
        items = items.filter(i => {
          const text = `${i.title} ${i.genre} ${i.tags.join(' ')}`.toLowerCase();
          return fuzzy(state.search, text);
        });
      }

      // Favorites/history views
      if (isFavorites) {
        items = items.filter(i => state.favorites.includes(i.id));
      }
      if (isHistory) {
        const ids = state.history.map(h => h.id);
        items = items.filter(i => ids.includes(i.id));
        // Sort by last played desc
        items.sort((a,b) => {
          const ta = state.history.find(h => h.id === a.id)?.at || 0;
          const tb = state.history.find(h => h.id === b.id)?.at || 0;
          return tb - ta;
        });
      } else {
        // Default sort: top score then title
        items.sort((a,b) => (bestScore(b) - bestScore(a)) || a.title.localeCompare(b.title));
      }

      // Paint grid
      gridEl.innerHTML = '';
      items.forEach(item => {
        const mirrors = filteredMirrors(item.mirrors);
        const best = mirrors[0];
        const card = document.createElement('article');
        card.className = 'card';
        card.innerHTML = `
          <div class="thumb"> ${item.title} </div>
          <div class="meta">
            <div class="row">
              <div>
                <strong>${item.title}</strong>
                <div style="font-size:12px;color:var(--muted)">${item.genre} • ${Math.round(best?.score*100)||'–'}% uptime</div>
              </div>
              <button class="pin" aria-label="Pin to favorites" title="Pin">${state.favorites.includes(item.id) ? '★' : '☆'}</button>
            </div>
            <div class="tags">
              ${item.tags.map(t => `<span class="tag">${t}</span>`).join('')}
            </div>
            <div class="row">
              <button class="play" ${best ? '' : 'disabled'}>Play</button>
              <select class="play" aria-label="Select mirror">
                ${mirrors.map(m => `<option value="${m.url}">${m.safe ? 'Sandbox' : 'Mirror'} • ${Math.round(m.score*100)}%</option>`).join('')}
              </select>
            </div>
          </div>
        `;
        const pinBtn = card.querySelector('.pin');
        pinBtn.addEventListener('click', () => toggleFavorite(item.id, pinBtn));

        const playBtn = card.querySelector('.play');
        const selectEl = card.querySelector('select');

        playBtn.addEventListener('click', () => {
          const url = selectEl.value || best?.url;
          if (!url) return alert('No available mirror for this game.');
          openPlayer(item.title, item.id, url);
        });

        gridEl.appendChild(card);
      });
    }

    /* Fuzzy search (very lightweight) */
    function fuzzy(q, text) {
      // Require all query tokens to appear
      const tokens = q.split(/\s+/).filter(Boolean);
      return tokens.every(tok => text.includes(tok));
    }

    function bestScore(item) {
      return Math.max(...item.mirrors.map(m => m.score));
    }

    /* Favorites */
    function toggleFavorite(id, pinBtn) {
      const idx = state.favorites.indexOf(id);
      if (idx >= 0) state.favorites.splice(idx, 1);
      else state.favorites.push(id);
      localStorage.setItem('pluto:favorites', JSON.stringify(state.favorites));
      pinBtn.textContent = state.favorites.includes(id) ? '★' : '☆';
    }

    /* History */
    function addHistory(id, title, url) {
      const entry = { id, title, url, at: Date.now() };
      // Remove duplicates then prepend
      const filtered = state.history.filter(h => h.id !== id);
      state.history = [entry, ...filtered].slice(0, 50);
      localStorage.setItem('pluto:history', JSON.stringify(state.history));
    }

    function showLastPlayed() {
      const last = state.history[0];
      if (!last) return alert('No recent games yet.');
      openPlayer(last.title, last.id, last.url);
    }

    /* Player */
    function openPlayer(title, id, url) {
      playerTitleEl.textContent = title;
      frameEl.src = url;
      playerEl.classList.add('visible');
      state.playing = { id, title, url };
      addHistory(id, title, url);
    }
    function closePlayer() {
      playerEl.classList.remove('visible');
      frameEl.src = 'about:blank';
      state.playing = null;
    }
    function popout() {
      if (!state.playing) return;
      window.open(state.playing.url, '_blank', 'noopener,noreferrer');
    }
    function loadNextInQueue() {
      // Demo: next is next in catalog order
      if (!state.playing) return;
      const idx = catalog.findIndex(c => c.id === state.playing.id);
      const next = catalog[(idx + 1) % catalog.length];
      const url = (state.safeMode ? next.mirrors.filter(m => m.safe) : next.mirrors)[0]?.url;
      if (!url) return alert('Next game has no available mirror.');
      openPlayer(next.title, next.id, url);
    }

    /* Initial render */
    render();

    /* Basic service worker for offline shell */
    if ('serviceWorker' in navigator) {
      const swCode = `
        const CACHE = 'pluto-shell-v1';
        const ASSETS = ['.', location.href];
        self.addEventListener('install', e => {
          e.waitUntil(caches.open(CACHE).then(c => c.addAll(ASSETS)));
        });
        self.addEventListener('fetch', e => {
          const req = e.request;
          e.respondWith(
            caches.match(req).then(res => res || fetch(req).catch(() => caches.match('./')))
          );
        });
      `;
      const blob = new Blob([swCode], { type: 'application/javascript' });
      const url = URL.createObjectURL(blob);
      navigator.serviceWorker.register(url).catch(() => {/* no-op */});
    }
  </script>
</body>
</html>
